<template>
    <div>
      <form @submit.prevent="registerUser">
        <div>
          <label>ชื่อ:</label>
          <input type="text" v-model="formData.username" required />
        </div>
  
        <div>
          <label>รหัสผ่าน:</label>
          <input type="password" v-model="formData.password" required />
        </div>
  
        <div>
          <label>อีเมล:</label>
          <input type="email" v-model="formData.email" required />
        </div>
  
        <div>
          <label>จังหวัด:</label>
          <select v-model="selectedProvince" @change="fetchDistricts" required>
            <option value="" disabled>เลือกจังหวัด</option>
            <option v-for="province in provinces" :key="province.id" :value="province.name">
              {{ province.name }}
            </option>
          </select>
        </div>
  
        <div>
          <label>อำเภอ:</label>
          <select v-model="selectedDistrict" @change="fetchSubDistricts" required>
            <option value="" disabled>เลือกอำเภอ</option>
            <option v-for="district in districts" :key="district.id" :value="district.name">
              {{ district.name }}
            </option>
          </select>
        </div>
  
        <div>
          <label>ตำบล:</label>
          <select v-model="formData.sub_district" required>
            <option value="" disabled>เลือกตำบล</option>
            <option v-for="subDistrict in subDistricts" :key="subDistrict.id" :value="subDistrict.name">
              {{ subDistrict.name }}
            </option>
          </select>
        </div>
  
        <button type="submit">ลงทะเบียน</button>
      </form>
    </div>
  </template>
  
  <script>
    import axios from "axios";
    
    export default {
      data() {
        return {
          formData: {
            username: "",
            password: "",
            email: "",
            province: "",
            district: "",
            sub_district: "",
          },
          provinces: [],
          districts: [],
          subDistricts: [],
          selectedProvince: "",
          selectedDistrict: "",
        };
      },
      methods: {
        async fetchProvinces() {
          try {
            const response = await axios.get("/provinces");
            this.provinces = response.data;
          } catch (error) {
            console.error("Error fetching provinces:", error);
          }
        },
        async fetchDistricts() {
          try {
            this.districts = [];
            this.subDistricts = [];
            const response = await axios.get(`/provinces/${this.selectedProvince}`);
            this.districts = response.data;
          } catch (error) {
            console.error("Error fetching districts:", error);
          }
        },
        async fetchSubDistricts() {
          try {
            this.subDistricts = [];
            const response = await axios.get(
              `/provinces/${this.selectedProvince}/${this.selectedDistrict}`
            );
            this.subDistricts = response.data;
          } catch (error) {
            console.error("Error fetching sub-districts:", error);
          }
        },
        async registerUser() {
          try {
            const response = await axios.post("/register", this.formData);
            alert("ลงทะเบียนสำเร็จ");
            console.log(response.data);
          } catch (error) {
            console.error("Error registering user:", error);
          }
        },
      },
      mounted() {
        this.fetchProvinces();
      },
    };
    </script>
    